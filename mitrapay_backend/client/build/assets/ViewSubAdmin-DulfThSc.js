import{r as n,b as W,j as e,L as w,h as X,q as v,y as i}from"./index-S0OVyHNu.js";import{a as q,F as A,h as J,c as M}from"./index-BQvgzHxm.js";import{P as Q}from"./Pagination-B8ab6gOf.js";import{g as Y,h as Z,i as ee,j as U}from"./DefaultLayout-D_FgM0Kl.js";import{M as p}from"./Modal-BTMROg-n.js";import{a as S}from"./index.esm-LEHn8Q-H.js";import{C as D}from"./CFormLabel-RGphUqCH.js";import{C as I}from"./CFormInput-DT5MO4RY.js";import"./CFocusTrap-DLS2BFbd.js";import"./cil-user-Dlmw-Gem.js";import"./index-CxJrV6_X.js";import"./setPrototypeOf-C3V6guyq.js";import"./CFormControlWrapper-D5pOIavM.js";import"./CFormControlValidation-DAm1qqxR.js";function me(){const a="rgb(255, 102, 178)",[m,b]=n.useState([]),[y,z]=n.useState(""),[g,k]=n.useState(1),[H,G]=n.useState(1),_=10,[K,h]=n.useState(!1),[x,E]=n.useState(null),[j,N]=n.useState(0),{user:C}=W(s=>s.user),B=async()=>{try{let s="";y.trim()?s=`/api/auth/Search_subadmin?searchKey=${encodeURIComponent(y)}&page=${g}&limit=${_}`:s=`/api/auth/View_subadmin?page=${g}&limit=${_}`;const t=await v.get(s,{withCredentials:!0});b(t.data.subadmins.map(o=>({...o,loadingStatus:!1}))),G(t.data.totalPages||1)}catch(s){s.response&&s.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error("Error fetching subadmins")}},P=async(s,t)=>{try{b(o=>o.map(d=>d._id===s?{...d,loadingStatus:!0}:d)),await v.put(`/api/auth/updateSubadminStatus/${s}`,{status:t},{withCredentials:!0}),i.success("Status updated"),b(o=>o.map(d=>d._id===s?{...d,status:t,loadingStatus:!1}:d))}catch(o){o.response&&o.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error("Failed to update status"),b(d=>d.map(f=>f._id===s?{...f,loadingStatus:!1}:f))}},T=s=>{E(s),N(0),h(!0)},O=async()=>{var s,t;if(j<=0){i.error("Credit must be a positive number.");return}try{await v.put("/api/auth/Add_Credit_subadmin",{Sub_admin_id:x._id,credit:Number(j)},{withCredentials:!0}),i.success("Credit added successfully!"),h(!1),E(null),N(0),B()}catch(o){o.response&&o.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to add credit")}};n.useEffect(()=>{B()},[y,g]);const V=s=>{z(s.target.value),k(1)},[F,R]=n.useState(null),$=s=>{const t=s==="Active";return{backgroundColor:t?"rgba(25,135,84,0.3)":"rgba(220,53,69,0.3)",color:t?"#4CAF50":"#FF6B6B",dotColor:t?"#4CAF50":"#FF6B6B"}},L="#121212",c="#1e1e1e",r="#e0e0e0",l="#9e9e9e",u="#282828";return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"3rem",backgroundColor:L,minHeight:"100vh",color:r},children:[e.jsx("div",{className:"px-4 px-md-5 py-4 mb-4 rounded-3 shadow-lg",style:{borderLeft:`6px solid ${a}`,backgroundColor:c},children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsx("h2",{className:"fw-bold mb-0",style:{color:r},children:"Co Admin Management"}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("img",{src:"https://placehold.co/48x48/333333/dddddd?text=A",alt:"Admin Avatar",className:"rounded-circle",width:"48",height:"48",onError:s=>{s.target.onerror=null,s.target.src="https://placehold.co/48x48/333333/dddddd?text=A"}}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-bold",style:{color:r},children:C.Name}),C.role!=="User"&&e.jsx("div",{className:"small",style:{color:l},children:C.role})]})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap gap-3 px-4 px-md-5 pt-0 pb-4",children:[e.jsx("div",{style:{maxWidth:"350px",width:"100%"},children:e.jsxs("div",{className:"input-group border rounded-pill shadow-sm",style:{borderColor:"#444",backgroundColor:c},children:[e.jsx("span",{className:"input-group-text border-0",style:{paddingLeft:"1rem",backgroundColor:"transparent",color:l},children:e.jsx(q,{})}),e.jsx("input",{type:"text",className:"form-control border-0",placeholder:"Search by name, username, or email...",value:y,onChange:V,style:{borderRadius:"0 50px 50px 0",padding:"10px 15px",backgroundColor:c,color:r}})]})}),e.jsxs(w,{to:"/CreateCOAdmin",className:"btn px-4 py-2 shadow fw-semibold d-flex align-items-center rounded-pill",style:{backgroundColor:a,color:"white",boxShadow:`0 4px 15px ${a}66`,transition:"all 0.3s ease"},children:[e.jsx(A,{className:"me-2"})," Create New Co Admin"]})]}),e.jsx("div",{className:"px-5 d-none d-md-block pb-5",children:e.jsx("div",{className:"rounded-3 shadow-lg",style:{overflow:"hidden",boxShadow:"0 15px 35px rgba(0, 0, 0, 0.4)",backgroundColor:c},children:e.jsxs("table",{className:"table table-borderless align-middle mb-0",style:{color:r},children:[e.jsx("thead",{style:{backgroundColor:u},children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4 text-uppercase small fw-bold py-3",style:{color:l},children:"User / Email"}),e.jsx("th",{className:"text-uppercase small fw-bold",style:{color:l},children:"Phone"}),e.jsx("th",{className:"text-uppercase small fw-bold text-end",style:{color:l},children:"Today's Payout"}),e.jsx("th",{className:"text-uppercase small fw-bold text-end",style:{color:l},children:"Credit Balance"}),e.jsx("th",{className:"text-uppercase small fw-bold text-end",style:{color:l},children:"Total Payout"}),e.jsx("th",{className:"text-uppercase small fw-bold text-center",style:{color:l},children:"Status"}),e.jsx("th",{className:"text-uppercase small fw-bold text-center",style:{color:l},children:"Actions"})]})}),e.jsxs("tbody",{children:[m.map((s,t)=>{const o=$(s.status);return e.jsxs("tr",{className:"py-2",onMouseEnter:()=>R(t),onMouseLeave:()=>R(null),style:{borderBottom:`1px solid ${u}`,backgroundColor:F===t?"#2a2a2a":c,transition:"background-color 0.2s"},children:[e.jsxs("td",{className:"ps-4 py-3",children:[e.jsx("div",{className:"fw-bold",style:{color:r},children:s==null?void 0:s.Name}),e.jsxs("div",{className:"small",style:{color:l},children:["@",s==null?void 0:s.User_name]}),e.jsx("div",{className:"small",style:{color:l},children:s==null?void 0:s.email})]}),e.jsx("td",{style:{color:r},children:s==null?void 0:s.Phone}),e.jsxs("td",{className:"text-end fw-medium",style:{color:r},children:["₹",(s==null?void 0:s.todayBalance)||0]}),e.jsxs("td",{className:"text-end fw-bold",style:{color:a},children:["₹",(s==null?void 0:s.credit)||0]}),e.jsxs("td",{className:"text-end",style:{color:l},children:["₹",(s==null?void 0:s.allTimeBalance)||0]}),e.jsx("td",{className:"text-center",children:e.jsxs("button",{className:"px-3 py-1 rounded-pill border-0 d-inline-flex align-items-center fw-medium",style:{...o,fontSize:"13px"},onClick:()=>P(s._id,s.status==="Active"?"Inactive":"Active"),disabled:s.loadingStatus,children:[s.loadingStatus?e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):e.jsx("span",{style:{...o,width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px",backgroundColor:o.dotColor}}),s.status==="Active"?"Active":"Inactive"]})}),e.jsx("td",{className:"text-center",children:e.jsxs(Y,{alignment:"end",visible:F===t,className:"d-inline-block",children:[e.jsx(Z,{color:"transparent",caret:!1,className:"border-0 bg-transparent p-0",style:{fontSize:"18px",color:l},children:e.jsx(J,{})}),e.jsxs(ee,{className:"shadow-lg border-0 p-1 rounded-3",style:{minWidth:"180px",backgroundColor:u},children:[e.jsx(U,{className:"d-flex align-items-center px-3 py-2 rounded-md",component:X,style:{transition:"background-color 0.1s",color:r},children:e.jsxs(w,{className:"d-flex align-items-center text-decoration-none",to:`/editCoAdmin/${s._id}`,style:{color:r},children:[e.jsx(M,{className:"me-2",style:{color:a}}),"Edit Permissions"]})}),e.jsxs(U,{className:"d-flex align-items-center px-3 py-2 rounded-md",onClick:()=>T(s),style:{transition:"background-color 0.1s",color:r},children:[e.jsx(A,{className:"me-2 text-success"}),"Add Credit"]})]})]})})]},s._id||t)}),m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-5",style:{color:l},children:"No Sub Admins found matching your search."})})]})]})})}),e.jsxs("div",{className:"px-3 d-md-none pb-5",children:[m.map((s,t)=>{const o=$(s.status);return e.jsxs("div",{className:"rounded-3 p-4 mb-3 shadow-sm",style:{borderLeft:`6px solid ${a}`,backgroundColor:c,color:r},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold fs-5 mb-1",style:{color:r},children:s==null?void 0:s.Name}),e.jsxs("div",{className:"small",style:{color:l},children:["@",s==null?void 0:s.User_name]})]}),e.jsxs("button",{className:"px-3 py-1 rounded-pill border-0 d-inline-flex align-items-center fw-medium",style:{...o,fontSize:"12px"},onClick:()=>P(s._id,s.status==="Active"?"Inactive":"Active"),disabled:s.loadingStatus,children:[e.jsx("span",{style:{...o,width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px",backgroundColor:o.dotColor}}),s.status==="Active"?"Active":"Inactive"]})]}),e.jsx("hr",{className:"my-3",style:{borderColor:"#333"}}),e.jsxs("div",{className:"row small g-3 fw-medium",children:[e.jsx("div",{className:"col-6",style:{color:l},children:"Email"}),e.jsx("div",{className:"col-6 text-end",style:{color:r},children:s==null?void 0:s.email}),e.jsx("div",{className:"col-6",style:{color:l},children:"Phone"}),e.jsx("div",{className:"col-6 text-end",style:{color:r},children:s==null?void 0:s.Phone}),e.jsx("div",{className:"col-6",style:{color:l},children:"Today's Payout"}),e.jsxs("div",{className:"col-6 text-end",style:{color:r},children:["₹",(s==null?void 0:s.todayBalance)||0]}),e.jsx("div",{className:"col-6",style:{color:l},children:"Credit Balance"}),e.jsx("div",{className:"col-6 text-end",children:e.jsxs("span",{style:{color:a},className:"fw-bold",children:["₹",(s==null?void 0:s.credit)||0]})})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-4 gap-2",children:[e.jsxs("button",{className:"btn btn-sm w-50 fw-semibold rounded-pill",style:{backgroundColor:`${a}33`,color:a,borderColor:a},onClick:()=>T(s),children:[e.jsx(A,{className:"me-1"})," Add Credit"]}),e.jsxs(w,{to:`/editCoAdmin/${s._id}`,className:"btn btn-dark btn-sm w-50 fw-semibold rounded-pill",style:{backgroundColor:u,borderColor:u,color:r},children:[e.jsx(M,{className:"me-1"})," Edit User"]})]})]},s._id||t)}),m.length===0&&e.jsx("div",{className:"text-center py-4",style:{color:l},children:"No Sub Admins found."})]}),e.jsx("div",{className:"px-5",children:e.jsx(Q,{page:g,totalPages:H,setPage:k})}),e.jsxs(p,{show:K,onHide:()=>h(!1),centered:!0,contentClassName:"dark-modal-content","aria-labelledby":"AddCreditModalLabel",className:"rounded-lg",style:{"--cui-modal-bg":c,"--cui-modal-content-bg":c,"--cui-modal-color":r},children:[e.jsxs(p.Header,{style:{borderBottom:`2px solid ${a}33`},children:[e.jsxs(p.Title,{id:"AddCreditModalLabel",className:"fw-bold",style:{color:a},children:["Add Credit to ",x==null?void 0:x.Name]}),e.jsx(S,{className:"btn-close",onClick:()=>h(!1),style:{filter:"invert(1) grayscale(100%) brightness(200%)"}})]}),e.jsxs(p.Body,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(D,{className:"fw-medium",style:{color:l},children:"Admin Name"}),e.jsx(I,{value:(x==null?void 0:x.Name)||"",disabled:!0,style:{borderRadius:"8px",backgroundColor:u,color:l,borderColor:"#333"}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(D,{className:"fw-medium",style:{color:l},children:"Credit Amount (in ₹)"}),e.jsx(I,{type:"number",value:j,onChange:s=>{const t=Math.max(0,Number(s.target.value));N(t)},style:{borderRadius:"8px",borderColor:"#333",backgroundColor:L,color:r},min:"0"})]})]}),e.jsxs(p.Footer,{style:{borderTop:`1px solid ${u}`},children:[e.jsx(S,{color:"secondary",onClick:()=>h(!1),style:{borderRadius:"8px",backgroundColor:l,color:c,borderColor:l},children:"Cancel"}),e.jsx(S,{color:"primary",onClick:O,style:{backgroundColor:a,color:"white",borderRadius:"8px",borderColor:a},children:"Add Credit"})]})]})]})}export{me as default};
