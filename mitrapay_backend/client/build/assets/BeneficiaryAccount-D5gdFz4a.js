import{b as H,r as u,e as O,j as e,L as _,q as D,y as p}from"./index-S0OVyHNu.js";import{a as P,F as T,m as q,c as K}from"./index-BQvgzHxm.js";import{P as V}from"./Pagination-B8ab6gOf.js";import{u as N,a as G,w as J}from"./xlsx-DgYx1jvH.js";import{F as Q}from"./FileSaver.min-5L8FvYvu.js";import{C as X,a as R}from"./CRow-DSL1DoSH.js";import{C as $}from"./CFormInput-DT5MO4RY.js";import"./CFormControlWrapper-D5pOIavM.js";import"./CFormControlValidation-DAm1qqxR.js";import"./CFormLabel-RGphUqCH.js";function xe(){const{user:l,error:Y,loading:ee,isAuthenticated:se}=H(s=>s.user),[v,M]=u.useState([]),[g,B]=u.useState(1),[L,W]=u.useState(1);O();const k=10,[n,C]=u.useState({searchKey:"",startdate:"",enddate:""}),S=async()=>{try{const s=n.searchKey.trim()==""&&n.startdate.trim()===""&&n.enddate.trim()===""?`/api/auth/View_account?page=${g}&limit=${k}`:`/api/auth/search_benficiery?searchKey=${encodeURIComponent(n.searchKey)}&page=${g}&limit=${k}&startDate=${encodeURIComponent(n.startdate)}&endDate=${encodeURIComponent(n.enddate)}`,a=(await D.get(s,{withCredentials:!0})).data;console.log(a,"data in beneficiary account"),M((a.BeneficiaryAccounts||[]).map(d=>({...d}))),W(a.pages||1)}catch(s){s.response&&s.response.data?p.error(s.response.data.message):(console.error(s),p.error("Failed to fetch beneficiary accounts")),s.response&&s.response.status===401&&(p.error("Unauthorized access. Please log in again."),window.location.reload()),p.error("Failed to benichery payouts")}};u.useEffect(()=>{S()},[g,n]);const[Z,f]=u.useState(!1),[x,A]=u.useState(null),b=s=>{A(s),f(!0)},w=()=>{f(!1),A(null)},z=()=>{const s=v.map(t=>{var o,c,i,h,j,U,I,E;return{"Beneficiary Name":t["Beneficiary Name"]||t.accountHolderName||t.name,"Beneficiary Code":t["Beneficiary Code"],"Beneficiary Account No.":t["Beneficiary Account No"]||t.accountNumber,"BIC / SWIFT / IFSC Code":t["BIC / SWIFT / IFSC Code"]||t.ifsc,"Beneficiary Bank Name":t["Beneficiary Bank Name"],"Beneficiary Address":t["Beneficiary Address 1"],"Effective From":t["Effective From"],"Payment Method Name":t["Payment Method Name"],Remark:t.remark||"N/A","Created By":((c=(o=t.createdBy)==null?void 0:o[0])==null?void 0:c.name)||"N/A","Created By Email":((h=(i=t.createdBy)==null?void 0:i[0])==null?void 0:h.email)||"N/A","Updated By":((U=(j=t.updatedBy)==null?void 0:j[0])==null?void 0:U.name)||"N/A","Updated By Email":((E=(I=t.updatedBy)==null?void 0:I[0])==null?void 0:E.email)||"N/A","Created At":t.createdAt?new Date(t.createdAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"}):"","Updated At":t.updatedAt?new Date(t.updatedAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"}):"",Status:t.status?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Unknown"}}),r=N.json_to_sheet(s),a=N.book_new();N.book_append_sheet(a,r,"Benificiery Accounts");const d=G(a,{bookType:"xlsx",type:"array"}),m=new Blob([d],{type:"application/octet-stream"});Q.saveAs(m,`Benificiery Accounts_${new Date().toISOString()}.xlsx`)},y=(s,r)=>{const a=N.json_to_sheet(s),d=N.book_new();N.book_append_sheet(d,a,"Sheet1"),J(d,`${r}.xlsx`)},F=s=>{var r,a,d,m,t,o,c,i;return[{"Beneficiary Name":s["Beneficiary Name"]||s.accountHolderName||s.name,"Beneficiary Code":s["Beneficiary Code"],"Beneficiary Account No.":s["Beneficiary Account No"]||s.accountNumber,"BIC / SWIFT / IFSC Code":s["BIC / SWIFT / IFSC Code"]||s.ifsc,"Beneficiary Bank Name":s["Beneficiary Bank Name"],"Beneficiary Address":s["Beneficiary Address 1"],"Effective From":s["Effective From"],"Payment Method Name":s["Payment Method Name"],Remark:s.remark||"N/A","Created By":((a=(r=s.createdBy)==null?void 0:r[0])==null?void 0:a.name)||"N/A","Created By Email":((m=(d=s.createdBy)==null?void 0:d[0])==null?void 0:m.email)||"N/A","Updated By":((o=(t=s.updatedBy)==null?void 0:t[0])==null?void 0:o.name)||"N/A","Updated By Email":((i=(c=s.updatedBy)==null?void 0:c[0])==null?void 0:i.email)||"N/A","Created At":s.createdAt?new Date(s.createdAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"}):"","Updated At":s.updatedAt?new Date(s.updatedAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"}):"",Status:s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Unknown"}]};return e.jsxs("div",{className:"  min-vh-100",children:[e.jsx("header",{className:"border-bottom px-4 px-md-5 py-3",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsx("h2",{className:"fw-semibold mb-0",children:"Accounts"}),e.jsxs("div",{className:"d-flex align-items-center gap-3 w-100 w-md-auto justify-content-between justify-content-md-end",children:[e.jsx("img",{src:"https://storage.googleapis.com/a1aa/image/bc142717-90f8-44af-ea05-493b2c81045c.jpg",alt:"Admin Avatar",className:"rounded-circle",width:"48",height:"48"}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-bold",children:l.Name}),l.role=="User"?"":e.jsx("div",{className:"text-muted small",children:l.role})]})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap gap-3 px-4 px-md-5 pt-4 pb-3",children:[e.jsx("div",{style:{maxWidth:"300px"},className:"w-100 w-md-auto",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text  border-end-0",children:e.jsx(P,{})}),e.jsx("input",{type:"text",className:"form-control border-start-0",placeholder:"Search Benificery",value:n.searchKey,onChange:s=>{C({...n,searchKey:s.target.value}),B(1)}})]})}),e.jsxs("div",{className:"d-flex flex-column flex-md-row gap-2 gap-md-0 align-items-center",children:[e.jsxs(X,{className:"",children:[e.jsx(R,{md:6,className:"d -flex flex-column",children:e.jsx($,{type:"date",id:"startDate",value:n.startdate,onChange:s=>{C({...n,startdate:s.target.value}),B(1)},placeholder:"Start date"})}),e.jsx(R,{md:6,children:e.jsx($,{type:"date",id:"endDate",value:n.enddate,onChange:s=>{C({...n,enddate:s.target.value}),B(1)},placeholder:"End date"})})]}),e.jsxs(_,{to:"/createAccounts",className:"btn btn-primary px-3 mx-md-4 my-2",children:[e.jsx(T,{className:"me-2"}),"Add Beneficiary Accounts"]}),e.jsxs("button",{className:"btn btn-success my-2",onClick:z,children:[e.jsx(q,{className:"me-2 "}),"Download Excel"]})]})]}),e.jsxs("div",{className:"d-flex d-md-none flex-column gap-3 px-4 pt-4 pb-3",children:[e.jsxs(_,{to:"/createAccounts",className:"btn btn-primary w-100",children:[e.jsx(T,{className:"me-2"}),"Create Accounts"]}),e.jsxs("div",{children:[e.jsx("label",{className:"fw-semibold",children:"Status:"}),e.jsx("select",{className:"form-select form-select-sm w-100 mt-1",children:e.jsx("option",{children:"Logged In"})})]}),e.jsx("div",{children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text  border-end-0 ",children:e.jsx(P,{})}),e.jsx("input",{type:"text",className:"form-control border-start-0",placeholder:"Search Accounts"})]})})]}),e.jsx("div",{className:"d-none d-md-block px-4  px-md-5 pb-5",children:e.jsx("div",{className:"table-responsive border rounded shadow-sm",children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("th",{className:"ps-4",children:"BIC / SWIFT / IFSC Code"}),e.jsx("th",{children:"Beneficiary Address 1"}),e.jsx("th",{children:"Beneficiary Bank Name"}),e.jsx("th",{children:"Beneficiary Account No"}),e.jsx("th",{children:"Beneficiary Name"}),e.jsx("th",{children:"Beneficiary Code"}),e.jsx("th",{children:"Effective From"}),e.jsx("th",{children:"Payment Method Name"}),e.jsx("th",{children:"Remark"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Approved By"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Updated At"}),e.jsx("th",{children:"Download excel"}),l.role==="Sub_Admin"||l.role==="Super_Admin"&&l.email!="tiger@gmail.com"?e.jsx("th",{style:{position:"sticky",right:0,zIndex:2},children:"Actions"}):""]})}),e.jsx("tbody",{children:v.map((s,r)=>{var a,d,m,t,o,c,i,h;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:`badge bg-light text-${s.status==="pending"?"warning":s.status==="approved"?"success":"danger"}`,children:[e.jsx("span",{className:`bg-${s.status==="pending"?"warning":s.status==="approved"?"success":"danger"} rounded-circle d-inline-block`,style:{width:"8px",height:"8px",marginRight:"6px"}}),s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Unknown"]})}),e.jsx("td",{children:s["BIC / SWIFT / IFSC Code"]||s.ifsc}),e.jsx("td",{children:s["Beneficiary Address 1"]}),e.jsx("td",{children:s["Beneficiary Bank Name"]}),e.jsx("td",{children:s["Beneficiary Account No"]||s.accountNumber}),e.jsx("td",{children:s["Beneficiary Name"]||s.accountHolderName}),e.jsx("td",{children:s["Beneficiary Code"]}),e.jsx("td",{children:s["Effective From"]}),e.jsx("td",{children:s["Payment Method Name"]}),e.jsx("td",{children:s.remark}),e.jsxs("td",{children:[((d=(a=s.createdBy)==null?void 0:a[0])==null?void 0:d.name)||"N/A"," ",e.jsx("br",{}),e.jsx("small",{children:(t=(m=s.createdBy)==null?void 0:m[0])==null?void 0:t.email})]}),e.jsxs("td",{children:[((c=(o=s.updatedBy)==null?void 0:o[0])==null?void 0:c.name)||"N/A"," ",e.jsx("br",{}),e.jsx("small",{children:(h=(i=s.updatedBy)==null?void 0:i[0])==null?void 0:h.email})]}),e.jsx("td",{children:new Date(s.createdAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"})}),e.jsx("td",{children:new Date(s.updatedAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>{const j=F(s);y(j,`Beneficiary_${s["Beneficiary Code"]||"User"}`)},children:"Download"})}),l.role==="Sub_Admin"||l.role==="Super_Admin"&&l.email!="tiger@gmail.com"?e.jsx("td",{style:{position:"sticky",right:0,zIndex:7,cursor:"pointer"},children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>b(s),children:e.jsx(K,{})})}):""]},r)})})]})})}),e.jsx("div",{className:"d-md-none px-3 pb-5",children:v.map((s,r)=>{var a,d,m,t,o,c,i,h;return e.jsxs("div",{className:"border rounded mb-3 p-3 shadow-sm",children:[e.jsxs("div",{className:"fw-bold mb-1",children:[s["Beneficiary Name"]||s.accountHolderName," ",e.jsxs("small",{className:"text-muted",children:["(",s["Beneficiary Code"]||"-",")"]})]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Account No:"})," ",s["Beneficiary Account No"]||s.accountNumber||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"IFSC/BIC/SWIFT:"})," ",s["BIC / SWIFT / IFSC Code"]||s.ifsc||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Bank:"})," ",s["Beneficiary Bank Name"]||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Address:"})," ",s["Beneficiary Address 1"]||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Effective From:"})," ",s["Effective From"]||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Payment Method:"})," ",s["Payment Method Name"]||"-"]}),e.jsxs("div",{className:"text-muted mb-1",children:[e.jsx("strong",{children:"Remark:"})," ",s.remark||"-"]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"px-2 py-1 rounded-pill d-inline-flex align-items-center",style:{backgroundColor:s.status==="pending"?"rgba(255,193,7,0.1)":s.status==="approved"?"rgba(25,135,84,0.1)":"rgba(220,53,69,0.1)",color:s.status==="pending"?"#ffc107":s.status==="approved"?"#198754":"#dc3545",fontSize:"13px"},children:[e.jsx("span",{style:{backgroundColor:s.status==="pending"?"#ffc107":s.status==="approved"?"#198754":"#dc3545",width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px"}}),s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Unknown"]})}),e.jsxs("div",{className:"text-muted mt-2",children:[e.jsx("strong",{children:"Created By:"})," ",((d=(a=s.createdBy)==null?void 0:a[0])==null?void 0:d.name)||"N/A"," ",e.jsx("br",{}),e.jsx("small",{children:(t=(m=s.createdBy)==null?void 0:m[0])==null?void 0:t.email})]}),e.jsxs("div",{className:"text-muted mt-1",children:[e.jsx("strong",{children:"Approved By:"})," ",((c=(o=s.updatedBy)==null?void 0:o[0])==null?void 0:c.name)||"N/A"," ",e.jsx("br",{}),e.jsx("small",{children:(h=(i=s.updatedBy)==null?void 0:i[0])==null?void 0:h.email})]}),e.jsxs("div",{className:"text-muted mt-1",children:[e.jsx("strong",{children:"Created At:"})," ",new Date(s.createdAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"})]}),e.jsxs("div",{className:"text-muted mt-1",children:[e.jsx("strong",{children:"Updated At:"})," ",new Date(s.updatedAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-3 gap-2 flex-wrap",children:[e.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>{const j=F(s);y(j,`Beneficiary_${s["Beneficiary Code"]||"User"}`)},children:"Download"}),(l.role==="Sub_Admin"||l.role==="Super_Admin")&&l.email!="tiger@gmail.com"&&e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>b(s),children:[e.jsx(K,{className:"me-1"})," Edit"]})]})]},r)})}),Z&&x&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["Update Status for ",x.name]}),e.jsx("button",{type:"button",className:"btn-close",onClick:w})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:x.status,onChange:s=>A({...x,status:s.target.value}),children:[e.jsx("option",{value:"approved",children:"Approve"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("ul",{className:"list-group",children:e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{children:"Remark:"}),e.jsx("input",{type:"text",className:"form-control mt-1",value:x.remark||"",onChange:s=>A(r=>({...r,remark:s.target.value}))})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:w,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{await D.put(`/api/auth/beneficiary/${x._id}/status`,{status:x.status,remark:x.remark}),p.success("Status updated successfully!"),w(),S()}catch(s){s.response&&s.response.status===401&&(p.error("Unauthorized access. Please log in again."),window.location.reload()),p.error("Failed to update status")}},children:"Save Changes"})]})]})})}),e.jsx(V,{page:g,totalPages:L,setPage:B})]})}export{xe as default};
