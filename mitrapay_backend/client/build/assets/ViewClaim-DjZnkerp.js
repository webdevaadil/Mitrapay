import{r,b as le,j as e,C as ne,q as g,y as i}from"./index-C3nOHlLd.js";import{a as re,c as H,k as T}from"./index-CkinNei2.js";import{P as ie}from"./Pagination-FUm_XSen.js";import{C as V,a as q,b as K}from"./CModalHeader-DMqTMqyC.js";import{C as O,a as W}from"./CModalTitle-U_Cvda1e.js";import{C as _}from"./CFormLabel-qyi4UhaA.js";import{C as P}from"./CFormInput-BmIdDdxq.js";import{a as M}from"./index.esm-D7uCn-1P.js";import"./tigerpay-Pmp4NT5g.js";import"./CCloseButton-CL-8eQOS.js";import"./CFormControlWrapper-DxqLpDfI.js";import"./CFormControlValidation-CW5_O4Cf.js";function fe(){var z;const[b,y]=r.useState([]),[f,Y]=r.useState(""),[C,D]=r.useState(1),[G,J]=r.useState(1),B=10,[Q,v]=r.useState(!1),[c,N]=r.useState(null),[X,F]=r.useState(!1),[Z,S]=r.useState(!1),[I,ee]=r.useState(null),[ae,U]=r.useState(0),{user:s}=le(a=>a.user),k=async()=>{v(!0);try{let a;f.trim()!==""?a=await g.get(`/api/auth/Search_claim?searchKey=${f}&page=${C}&limit=${B}`,{withCredentials:!0}):a=await g.get(`/api/auth/View_claim?page=${C}&limit=${B}`,{withCredentials:!0}),y(a.data.claims),J(a.data.pages)}catch(a){a.response&&a.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload())}finally{v(!1)}};r.useEffect(()=>{k()},[f,C]);const se=async(a,n)=>{try{y(t=>t.map(l=>l._id===a?{...l,loadingStatus:!0}:l)),await g.put(`/api/auth/updateClaimStatus/${a}`,{status:n},{withCredentials:!0}),i.success("Status updated"),y(t=>t.map(l=>l._id===a?{...l,status:n,loadingStatus:!1}:l))}catch(t){t.response&&t.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error("Failed to update status"),y(l=>l.map(d=>d._id===a?{...d,loadingStatus:!1}:d))}},L=async a=>{var n;v(!0);try{await g.post("/api/auth/DeleteClaim",{id:a._id},{withCredentials:!0}),i.success("Claim Deleted Successfully"),S(!1),ee(null),U(0),k()}catch(t){t.response&&t.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error(((n=t.response)==null?void 0:n.data)||"Failed to delete claim")}finally{v(!1)}};function w(a){if(!a)return"";var n=new Date(a),t=("0"+(n.getMonth()+1)).slice(-2),l=("0"+n.getDate()).slice(-2);return[n.getFullYear(),t,l].join("-")}const R=a=>{N(a),F(!0)},A=()=>{F(!1),N(null)},te=async()=>{if(c)try{await g.put(`/api/auth/updateClaimStatus/${c._id}`,{status:c.status,remark:c.remark}),i.success("Remark and status updated successfully!"),A(),k()}catch(a){a.response&&a.response.status===401&&(i.error("Unauthorized access. Please log in again."),window.location.reload()),i.error("Failed to update remark and status")}};return e.jsxs("div",{children:[e.jsx("div",{className:"border-bottom px-4 px-md-5 py-3",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsx("h2",{className:"fw-semibold mb-0",children:"ViewClaim"}),e.jsxs("div",{className:"d-flex align-items-center gap-3 w-100 w-md-auto justify-content-between justify-content-md-end",children:[e.jsx("img",{src:"https://storage.googleapis.com/a1aa/image/bc142717-90f8-44af-ea05-493b2c81045c.jpg",alt:"user Avatar",className:"rounded-circle",width:"48",height:"48"}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-bold",children:s==null?void 0:s.Name}),(s==null?void 0:s.role)==="User"?"":e.jsx("div",{className:"text-muted small",children:s==null?void 0:s.role})]})]})]})}),e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 px-4 px-md-5 pt-4 pb-3",children:e.jsx("div",{className:"w-100 order-2 order-md-1",style:{maxWidth:"300px"},children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text border-end-0",children:e.jsx(re,{})}),e.jsx("input",{type:"text",className:"form-control border-start-0",placeholder:"Search User",value:f,onChange:a=>{Y(a.target.value),D(1)}})]})})}),e.jsx("div",{className:"px-5 d-none d-md-block pb-5",children:e.jsx("div",{className:"table-responsive d-none d-md-block border rounded shadow-sm",children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{style:{backgroundColor:"#f8f9fa"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4",children:"Name"}),e.jsx("th",{children:"Remark"}),e.jsx("th",{children:"CLAIM Status"}),e.jsx("th",{children:"Account Number"}),e.jsx("th",{children:"Account Holder Name"}),e.jsx("th",{children:"Amount"}),((s==null?void 0:s.role)==="Super_Admin"||(s==null?void 0:s.role)==="Sub_Admin")&&(s==null?void 0:s.email)!=="tiger@gmail.com"&&e.jsx("th",{children:"Bank utr"}),e.jsx("th",{children:"utr"}),e.jsx("th",{children:"Claim Date"}),e.jsx("th",{children:"Payout Date"}),e.jsx("th",{children:"Payment status"}),e.jsx("th",{children:"IFSC"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{className:"ps-6",children:"Payment_By"}),e.jsx("th",{className:"ps-6",children:"Claim_By"}),e.jsx("th",{children:"Action"})]})}),Q?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"12",className:"text-center py-5",children:e.jsx(ne,{color:"primary",style:{width:"3rem",height:"3rem"}})})})}):e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"12",className:"text-center py-4 text-muted",children:"No Claim found"})}):b.map((a,n)=>{var t,l,d,o,h,m,x,u,j,p,$,E;return e.jsxs("tr",{children:[e.jsx("td",{className:"ps-4 py-3",children:a.claimby[0].Name}),e.jsx("td",{children:a.remark}),e.jsx("td",{children:e.jsxs("button",{className:"px-3 py-1 rounded-pill border-0 d-inline-flex align-items-center",style:{backgroundColor:a.status==="Active"?"rgba(25,135,84,0.1)":"rgba(220,53,69,0.1)",color:a.status==="Active"?"#198754":"#dc3545",fontSize:"13px"},onClick:()=>se(a._id,a.status==="Active"?"Inactive":"Active"),disabled:a.loadingStatus,children:[e.jsx("span",{style:{backgroundColor:a.status==="Active"?"#198754":"#dc3545",width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px"}}),a.status==="Active"?"Active":"Inactive"]})}),e.jsx("td",{children:a.accountNumber}),e.jsx("td",{children:a.accountHolderName}),e.jsx("td",{children:a.Amount}),((s==null?void 0:s.role)==="Super_Admin"||(s==null?void 0:s.role)==="Sub_Admin")&&(s==null?void 0:s.email)!=="tiger@gmail.com"&&e.jsx("td",{children:a.utr||""}),e.jsx("td",{children:a.Bank_Utr||a.utr}),e.jsx("td",{children:w(a.Date)}),e.jsx("td",{children:w(a.payoutdate)}),e.jsx("td",{children:a.CLAIMstatus}),e.jsx("td",{children:a.ifsc}),e.jsx("td",{children:a.claimby[0].Phone}),e.jsxs("td",{children:[(d=(l=(t=a.Payment_By)==null?void 0:t[0])==null?void 0:l[0])==null?void 0:d.role," (",(m=(h=(o=a.Payment_By)==null?void 0:o[0])==null?void 0:h[0])==null?void 0:m.email,") "]}),e.jsxs("td",{children:[(j=(u=(x=a.claimby)==null?void 0:x[0])==null?void 0:u[0])==null?void 0:j.role," (",(E=($=(p=a.claimby)==null?void 0:p[0])==null?void 0:$[0])==null?void 0:E.email,") "]}),(s==null?void 0:s.role)==="Sub_Admin"||(s==null?void 0:s.role)==="Super_Admin"&&(s==null?void 0:s.email)!=="tiger@gmail.com"?e.jsxs("td",{style:{position:"sticky",right:0,zIndex:7,cursor:"pointer",backgroundColor:"#fff"},children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>R(a),children:e.jsx(H,{})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>L(a),children:e.jsx(T,{})})]}):e.jsx("td",{style:{position:"sticky",right:0,zIndex:7}})]},n)})})]})})}),e.jsx("div",{className:"px-3 d-md-none pb-5 mt-3",children:b.length===0?e.jsx("div",{className:"text-center text-muted py-4",children:"No Claim found"}):b.map((a,n)=>{var t,l,d,o,h,m,x,u,j,p;return e.jsxs("div",{className:"border rounded mb-3 p-3 shadow-sm",style:{backgroundColor:"#ffffff"},children:[e.jsx("div",{className:"fw-bold mb-1",children:(l=(t=a.claimby)==null?void 0:t[0])==null?void 0:l.Name}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",(o=(d=a.claimby)==null?void 0:d[0])==null?void 0:o.Phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Account Number:"})," ",a.accountNumber]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Account Holder Name:"})," ",a.accountHolderName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"IFSC:"})," ",a.ifsc]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"})," ",a.Amount]}),((s==null?void 0:s.role)==="Super_Admin"||(s==null?void 0:s.role)==="Sub_Admin")&&(s==null?void 0:s.email)!=="tiger@gmail.com"&&e.jsxs("div",{children:[e.jsx("strong",{children:"utr:"})," ",a.utr]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Bank utr:"})," ",a.Bank_Utr||a.utr]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Payment By:"})," ",(x=(m=(h=a.Payment_By)==null?void 0:h[0])==null?void 0:m[0])==null?void 0:x.role," (",(p=(j=(u=a.Payment_By)==null?void 0:u[0])==null?void 0:j[0])==null?void 0:p.email,")"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Payment status:"})," ",a.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CLAIM status:"})," ",a.CLAIMstatus]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remark:"})," ",a.remark]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",w(a.Date)]}),e.jsx("div",{className:"d-flex justify-content-start gap-2 mt-2",children:((s==null?void 0:s.role)==="Sub_Admin"||(s==null?void 0:s.role)==="Super_Admin"&&(s==null?void 0:s.email)!=="tiger@gmail.com")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>R(a),children:e.jsx(H,{})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>L(a),children:e.jsx(T,{})})]})})]},n)})}),e.jsxs(V,{visible:Z,onClose:()=>S(!1),"aria-labelledby":"LiveDemoExampleLabel",children:[e.jsx(q,{children:e.jsx(O,{id:"LiveDemoExampleLabel",children:"Add Credit"})}),e.jsxs(K,{children:[e.jsxs(_,{children:["Name",e.jsx(P,{value:I&&((z=I[0])==null?void 0:z.Name),disabled:!0})]}),e.jsxs(_,{children:["Credit",e.jsx(P,{type:"number",value:ae,onChange:a=>{U(a.target.value)}})]})]}),e.jsx(W,{children:e.jsx(M,{color:"secondary",onClick:()=>S(!1),children:"Close"})})]}),e.jsx(ie,{page:C,totalPages:G,setPage:D}),e.jsxs(V,{visible:X,onClose:A,"aria-labelledby":"UpdateRemarkModalLabel",backdrop:"static",children:[e.jsx(q,{children:e.jsx(O,{id:"UpdateRemarkModalLabel",children:"Update Remark"})}),e.jsx(K,{children:c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{children:["Remark:",e.jsx(P,{type:"text",className:"mt-1",value:c.remark||"",onChange:a=>N(n=>({...n,remark:a.target.value}))})]}),e.jsxs("p",{className:"text-muted small mt-2",children:["Claim ID: ",c._id]})]})}),e.jsxs(W,{children:[e.jsx(M,{color:"secondary",onClick:A,children:"Cancel"}),e.jsx(M,{color:"primary",onClick:te,children:"Save Changes"})]})]})]})}export{fe as default};
