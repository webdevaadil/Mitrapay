import{b as ae,r as m,j as e,C as L,q as h,y as i}from"./index-S0OVyHNu.js";import{n as $,m as E,o as te,p as re,b as ce}from"./index-BQvgzHxm.js";import{C as A}from"./CForm-TVZgw3-3.js";import{C as _,a as O}from"./CCardBody-CBNdoKh7.js";import{C as R}from"./CCardHeader-B-oarDzT.js";import{C as I}from"./CFormInput-DT5MO4RY.js";import{a as d}from"./index.esm-LEHn8Q-H.js";import{C as H}from"./CFormLabel-RGphUqCH.js";import{C as z}from"./CCardFooter-D6EFKgoo.js";import{C as ne,a as ie,b as G,c as f,d as de,e as C}from"./CTable-BvAUGneY.js";import{C as ue}from"./CBadge-kW0wuZL8.js";import{C as me,a as pe,b as he}from"./CModalHeader-Unm983Bg.js";import{C as xe,a as ye}from"./CModalTitle-Ci3Ps_-Q.js";import{C as be}from"./CFormSelect-5TVPsKZy.js";import"./CFormControlWrapper-D5pOIavM.js";import"./CFormControlValidation-DAm1qqxR.js";import"./CFocusTrap-DLS2BFbd.js";import"./CCloseButton-ThnMeZd7.js";const fe=""+new URL("Bulkpayout-MpMBVDYr.xlsx",import.meta.url).href,a="#ff66b2",Ce="#1e1e1e",u="#2c2c2c",S="#383838",t="#ffffff",p="#b3b3b3",n="#555555",F="rgba(255, 102, 178, 0.2)";function Ee(){const{user:B}=ae(s=>s.user),[j,k]=m.useState(!0),[g,x]=m.useState(null),[T,y]=m.useState(""),[V,v]=m.useState(!1),[w,K]=m.useState(null),[N,D]=m.useState(""),X=s=>{const l=s.target.files[0];l&&(l.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||l.type==="application/vnd.ms-excel")?(x(l),y("")):(y("Please upload a valid Excel file (.xlsx or .xls)."),x(null))},Y=async s=>{var r,c;if(s.preventDefault(),!g){y("No file selected");return}const l=new FormData;l.append("file",g);try{const o=await h.post("/api/auth/UploadBUlkPayoutfile",l,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});i.success(o.data)}catch(o){i.error(((c=(r=o.response)==null?void 0:r.data)==null?void 0:c.error)||"Upload failed")}finally{b(),x(null),document.getElementById("csvFile").value=""}},[U,q]=m.useState([]),b=async()=>{k(!0);try{const s=await h.get("/api/auth/ViewBUlkPayoutfiles",{withCredentials:!0});q(s.data.data)}catch(s){console.error(s),i.error("Failed to fetch files.")}finally{k(!1)}};m.useEffect(()=>{b()},[]);const Z=async(s,l)=>{try{const r=await h.get(`/api/auth/downloadBUlkPayoutfile/${s}`,{responseType:"blob",withCredentials:!0}),c=window.URL.createObjectURL(new Blob([r.data])),o=document.createElement("a");o.href=c,o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(c)}catch(r){console.error("Download failed",r),i.error("Download failed.")}},J=async()=>{if(w)try{await h.put(`/api/auth/Bulk-Payout/${w._id}/status`,{status:N},{withCredentials:!0}),i.success(`Status updated to ${N}`),v(!1),b()}catch(s){console.error("Status update failed",s),i.error("Status update failed.")}},Q=async(s,l)=>{if(!l)return;const r=new FormData;r.append("file",l);try{await h.post(`/api/auth/upload-bank-file/${s}`,r,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),i.success("Bank file uploaded successfully!"),b()}catch(c){console.log(c),i.error("Bank file upload failed.")}},W=async s=>{var l,r;try{k(!0);const c=await h.post(`/api/auth/bulk-Payout/process/${s}`,{},{withCredentials:!0});i.success(`âœ… ${c.data.inserted} Payouts processed.`),b()}catch(c){console.log(c),i.error(((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||"Processing failed.")}finally{k(!1)}},ee=s=>{switch(s.toLowerCase()){case"processed":return{color:"success",text:"Processed"};case"pending":return{color:"warning",text:"Pending"};case"failed":return{color:"danger",text:"Failed"};default:return{color:"secondary",text:s}}},se=s=>{K(s),D(s.status),v(!0)},le=s=>{const l=s.target.files[0];l.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||l.type==="application/vnd.ms-excel"?(x(l),y("")):(y("Please upload a valid CSV file."),x(null))},oe=async s=>{var r,c;if(s.preventDefault(),!g){y("No file selected");return}const l=new FormData;l.append("file",g);try{const o=await h.post("/api/auth/add_Bulk_utr_Payout",l,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});console.log(o.data),i.success(e.jsxs("div",{children:[e.jsx("strong",{children:"Bulk Payouts Summary: âœ…"}),e.jsx("br",{}),"âœ”ï¸ ",e.jsx("b",{children:"Success:"})," ",o.data.success?"true":"false",e.jsx("br",{}),"ðŸ“Œ ",e.jsx("b",{children:"Message:"})," ",o.data.message,e.jsx("br",{}),"ðŸ“Š ",e.jsx("b",{children:"Total Rows:"})," ",o.data.totalRows,e.jsx("br",{}),"âž• ",e.jsx("b",{children:"Inserted:"})," ",o.data.inserted,e.jsx("br",{}),"â­ï¸ ",e.jsx("b",{children:"Skipped:"})," ",o.data.skipped,e.jsx("br",{}),"âŒ ",e.jsx("b",{children:"Failed:"})," ",o.data.failed]}),{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(o){i.error(((c=(r=o.response)==null?void 0:r.data)==null?void 0:c.error)||"Upload failed")}finally{b(),x(null)}};return e.jsxs("div",{className:"container-fluid py-4",style:{backgroundColor:Ce,minHeight:"90vh",color:t},children:[B.role!=="User"&&e.jsxs(A,{onSubmit:oe,className:"mb-3",children:[e.jsxs(_,{className:"mb-4 shadow-lg",style:{backgroundColor:u,color:t,borderColor:n,borderTop:`4px solid ${a}`},children:[" ",e.jsx(R,{style:{backgroundColor:a,color:"white"},children:e.jsx("h5",{className:"mb-0 fw-bold",children:"Bulk Set UTR"})}),e.jsx(I,{type:"file",id:"csvFile",accept:" application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:le}),e.jsx("br",{})]}),e.jsx(d,{type:"submit",style:{backgroundColor:a,borderColor:a},className:"text-white",children:"Submit"})]}),e.jsxs(_,{className:"mb-4 shadow-lg",style:{backgroundColor:u,color:t,borderColor:n,borderTop:`4px solid ${a}`},children:[e.jsx(R,{style:{backgroundColor:a,color:"white"},children:e.jsx("h5",{className:"mb-0 fw-bold",children:"Multiple Payments File Upload ðŸ“¤"})}),e.jsx(O,{children:e.jsxs(A,{onSubmit:Y,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs(H,{htmlFor:"csvFile",className:"fw-bold",style:{color:t},children:["Select Excel File for Multiple Payments (",e.jsx("span",{style:{color:a},children:".xlsx or .xls"}),")"]}),e.jsx(I,{type:"file",id:"csvFile",accept:"application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:X,className:T?"is-invalid":"",style:{"--cui-focus-ring-color":F,"--cui-active-border-color":a,backgroundColor:S,color:t,borderColor:n}}),T&&e.jsx("div",{className:"invalid-feedback",children:T})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxs(d,{type:"submit",style:{backgroundColor:a,borderColor:a},className:"text-white",disabled:!g||j,children:[e.jsx($,{className:"me-1"})," ",j?e.jsx(L,{size:"sm"}):"Submit Upload"]}),e.jsxs(d,{variant:"outline",href:fe,download:"sample.xlsx",style:{color:a,borderColor:a},className:"fw-medium",children:[e.jsx(E,{className:"me-1"})," Download Sample File"]})]})]})}),e.jsxs(z,{style:{backgroundColor:F,borderTop:`1px solid ${n}`},children:[e.jsx("p",{className:"mb-1",style:{color:a},children:e.jsx("small",{className:"fw-bold",children:"Instructions:"})}),e.jsxs("ul",{className:"list-unstyled mb-0 ms-3",children:[e.jsx("li",{style:{color:t},children:e.jsxs("small",{children:["Before the beneficiary account number, you **must** put this (",e.jsx("code",{style:{color:a},children:"'"}),") sign. It is compulsory."]})}),e.jsx("li",{style:{color:t},children:e.jsx("small",{children:"*Beneficiary code (Beneficiary Nick Name) should not contain any spaces."})})]})]})]}),e.jsxs(_,{className:"mt-4 shadow-lg",style:{backgroundColor:u,color:t,borderColor:n},children:[e.jsx(R,{className:"fw-bold",style:{backgroundColor:F,color:a,borderBottom:`1px solid ${n}`},children:e.jsx("h5",{children:"Uploaded Multiple Payments Files History ðŸ“‹"})}),e.jsx(O,{children:j&&!U.length?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(L,{style:{color:a,width:"4rem",height:"4rem"}}),e.jsx("p",{className:"mt-2",style:{color:p},children:"Loading files..."})]}):U.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"lead",style:{color:p},children:"No files uploaded yet. Start by uploading a file above. â¬†ï¸"})}):e.jsxs(ne,{striped:!0,hover:!0,responsive:!0,className:"align-middle",style:{color:t,border:`1px solid ${n}`},children:[e.jsx(ie,{style:{backgroundColor:S,color:t},children:e.jsxs(G,{children:[e.jsx(f,{style:{color:t},children:"File Name"}),e.jsx(f,{style:{color:t},children:"Uploaded By"}),e.jsx(f,{style:{color:t},children:"Role"}),e.jsx(f,{className:"text-center",style:{color:t},children:"Status"}),e.jsx(f,{style:{color:t},children:"Uploaded At (IST)"}),e.jsx(f,{className:"text-center",style:{color:t},children:"Actions"})]})}),e.jsx(de,{children:U.toReversed().map((s,l)=>{var o,M;const r=ee(s.status),c=s.status.toLowerCase()==="processed";return e.jsxs(G,{style:{backgroundColor:l%2===0?u:S},children:[e.jsx(C,{className:"fw-semibold",style:{color:a},children:s.filename}),e.jsx(C,{style:{color:p},children:((o=s.uploadedBy)==null?void 0:o.email)||"N/A"}),e.jsx(C,{style:{color:p},children:((M=s.uploadedBy)==null?void 0:M.role)||"User"}),e.jsx(C,{className:"text-center",children:e.jsx(ue,{color:r.color,shape:"rounded-pill",className:"px-3 py-2 fw-bold",children:r.text})}),e.jsx(C,{className:"small text-nowrap",style:{color:p},children:new Date(s.createdAt).toLocaleString("en-US",{timeZone:"Asia/Kolkata",day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx(C,{children:e.jsxs("div",{className:"d-flex flex-wrap justify-content-center gap-2",children:[e.jsx(d,{color:"primary",size:"sm",variant:"outline",onClick:()=>Z(s._id,s.filename),title:"Download Uploaded File",style:{color:a,borderColor:a},children:e.jsx(E,{})}),(B.role==="Super_Admin"||B.role==="Sub_Admin")&&!c&&e.jsxs(e.Fragment,{children:[s.bankFile?e.jsxs(d,{color:"success",size:"sm",onClick:()=>W(s._id),disabled:j,title:"Process Multiple Payments from Bank File",children:[j?e.jsx(te,{className:"spin"}):e.jsx(re,{})," Process"]}):e.jsxs(d,{color:"warning",size:"sm",variant:"outline",onClick:()=>document.getElementById(`bankFile-${s._id}`).click(),title:"Upload Bank Response File",style:{borderColor:"gold",color:"gold"},children:[e.jsx($,{})," Bank",e.jsx("input",{id:`bankFile-${s._id}`,type:"file",style:{display:"none"},accept:".xlsx, .xls, .csv",onChange:P=>Q(s._id,P.target.files[0]),onClick:P=>P.target.value=null})]}),e.jsxs(d,{color:"secondary",size:"sm",variant:"outline",onClick:()=>se(s),title:"Manually Change File Status",style:{color:p,borderColor:n},children:[e.jsx(ce,{})," Status"]})]})]})})]},s._id)})})]})}),e.jsx(z,{style:{backgroundColor:u,borderTop:`1px solid ${n}`}})]}),e.jsxs(me,{alignment:"center",visible:V,onClose:()=>v(!1),className:"dark-modal-custom",style:{"--cui-modal-bg":u,"--cui-modal-color":t},children:[e.jsx(pe,{style:{backgroundColor:F,borderBottom:`1px solid ${n}`},children:e.jsx(xe,{className:"fw-bold",style:{color:a},children:"Change File Status"})}),e.jsxs(he,{children:[e.jsxs("p",{className:"mb-3",children:["Current File: ",e.jsx("span",{className:"fw-semibold",style:{color:t},children:w==null?void 0:w.filename})]}),e.jsx(H,{htmlFor:"statusSelect",className:"fw-medium",style:{color:p},children:"Select New Status"}),e.jsxs(be,{id:"statusSelect",value:N,onChange:s=>D(s.target.value),style:{backgroundColor:S,color:t,borderColor:n,filter:"invert(0.8) grayscale(1) brightness(1.5)"},children:[e.jsx("option",{value:"Pending",style:{backgroundColor:u},children:"Pending"}),e.jsx("option",{value:"Processed",style:{backgroundColor:u},children:"Processed"}),e.jsx("option",{value:"Failed",style:{backgroundColor:u},children:"Failed"})]})]}),e.jsxs(ye,{style:{borderTop:`1px solid ${n}`},children:[e.jsx(d,{variant:"outline",onClick:()=>v(!1),style:{color:p,borderColor:n},children:"Cancel"}),e.jsx(d,{style:{backgroundColor:a,borderColor:a},className:"text-white",onClick:J,disabled:!N,children:"Save Changes"})]})]})]})}export{Ee as default};
