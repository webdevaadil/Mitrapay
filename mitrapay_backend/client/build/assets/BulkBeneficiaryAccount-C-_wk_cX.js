import{b as _,r as l,j as e,C as g,q as d,y as p}from"./index-C3nOHlLd.js";import"./FileSaver.min-Bww21GLX.js";import{C as z}from"./CForm-C3F__wpl.js";import{C}from"./CFormLabel-qyi4UhaA.js";import{C as V}from"./CFormInput-BmIdDdxq.js";import{a as i}from"./index.esm-D7uCn-1P.js";import{C as $,a as H}from"./CCardBody-CUr9J0O8.js";import{C as O}from"./CCardHeader-CrvxRClZ.js";import{C as Z,a as q,b as v,c as n,d as I,e as c}from"./CTable-Brt9Q5lx.js";import{C as K,a as W,b as X}from"./CModalHeader-DMqTMqyC.js";import{C as Y,a as G}from"./CModalTitle-U_Cvda1e.js";import{C as J}from"./CFormSelect-Bvp8DOoI.js";import"./CFormControlWrapper-DxqLpDfI.js";import"./CFormControlValidation-CW5_O4Cf.js";import"./tigerpay-Pmp4NT5g.js";import"./CCloseButton-CL-8eQOS.js";const Q=""+new URL("BENEUPLOD-DyYWzPXZ.xlsx",import.meta.url).href;function ye(){const{user:f,error:ee,isAuthenticated:se}=_(s=>s.user),[y,j]=l.useState(null),[B,u]=l.useState(!1),[ae,m]=l.useState(""),[F,h]=l.useState(!1),[b,k]=l.useState(null),[w,S]=l.useState(""),U=s=>{const a=s.target.files[0];a.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||a.type==="application/vnd.ms-excel"?(j(a),m("")):(m("Please upload a valid CSV file."),j(null))},D=async s=>{var t,r;if(s.preventDefault(),!y){m("No file selected");return}const a=new FormData;a.append("file",y);try{u(!0);const o=await d.post("/api/auth/UploadBUlkBenificieryaccount",a,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});p.success(o.data)}catch(o){p.error(((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.error)||"Upload failed")}finally{x(),j(null),u(!1)}},[N,A]=l.useState([]),[T,M]=l.useState(!0),x=async()=>{try{const s=await d.get("/api/auth/ViewBUlkBenificieryaccount",{withCredentials:!0});A(s.data.data)}catch(s){console.error(s)}finally{M(!1)}};l.useEffect(()=>{x()},[]);const R=async(s,a)=>{try{const t=await d.get(`/api/auth/downloadBUlkBenificieryaccount/${s}`,{responseType:"blob",withCredentials:!0}),r=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=r,o.setAttribute("download",a),document.body.appendChild(o),o.click(),o.remove()}catch(t){console.error("Download failed",t)}},L=async()=>{if(b)try{await d.put(`/api/auth/bulk-beneficiary/${b._id}/status`,{status:w},{withCredentials:!0}),h(!1),x()}catch(s){console.error("Status update failed",s)}},P=s=>{k(s),S(s.status),console.log(s,"file in open status modal"),h(!0)},E=async s=>{var a,t;if(!s){m("Upload a file first.");return}u(!0);try{const r=await d.post(`/api/auth/bulk-beneficiaries/process/${s}`);p.success(`✅ ${r.data.inserted} beneficiaries inserted successfully.`),x(),r.data.skiped&&r.data.skiped>0&&p.info(`⚠️ ${r.data.skiped} beneficiaries were skipped as they already exist.`)}catch(r){console.log(r),p.error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)||"Processing failed")}finally{u(!1)}};return console.log(f),e.jsxs("div",{children:[e.jsxs(z,{onSubmit:D,className:"mb-3",children:[e.jsx(C,{htmlFor:"csvFile",children:"Upload CSV File"}),e.jsx(V,{type:"file",id:"csvFile",accept:" application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:U}),e.jsx(i,{type:"submit",className:"mt-2 btn-primary",children:"Submit"}),e.jsx("br",{}),e.jsx(i,{type:"Button",className:"ml-2 mt-2 btn-primary",href:Q,download:"sample.xlsx",children:"Download Sample file"}),e.jsx("br",{}),e.jsx(C,{children:"Before the beneficiary account number, you must put this ( ' ) sign. It is compulsory."}),e.jsx("br",{}),e.jsx(C,{children:"*Beneficiary code(Beneficiary Nick Name) should not contain any space."})]}),e.jsxs($,{className:"mt-4 shadow-sm",children:[e.jsx(O,{children:e.jsx("h5",{children:"Uploaded Beneficiary Files"})}),e.jsx(H,{children:T?e.jsx(g,{color:"primary"}):e.jsxs(Z,{striped:!0,hover:!0,responsive:!0,bordered:!0,children:[e.jsx(q,{color:"dark",children:e.jsxs(v,{children:[e.jsx(n,{scope:"col",children:"File Name"}),e.jsx(n,{scope:"col",children:"Uploaded By"}),e.jsx(n,{scope:"col",children:"Role"}),e.jsx(n,{scope:"col",children:"Status"}),e.jsx(n,{scope:"col",children:"Uploaded At"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(I,{children:N.toReversed().map(s=>{var a,t;return e.jsxs(v,{children:[e.jsx(c,{children:s.filename}),e.jsx(c,{children:(a=s.uploadedBy)==null?void 0:a.email}),e.jsx(c,{children:(t=s.uploadedBy)==null?void 0:t.role}),e.jsx(c,{children:s.status}),e.jsx(c,{children:new Date(s.createdAt).toLocaleString("en-Us",{timeZone:"Asia/Kolkata"})}),e.jsx(c,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(i,{color:"primary",size:"sm",variant:"outline",onClick:()=>R(s._id,s.filename),children:"Download"}),(f.role==="Super_Admin"||f.role==="Sub_Admin")&&e.jsxs(e.Fragment,{children:[e.jsx(i,{color:"warning",size:"sm",variant:"outline",onClick:()=>P(s),children:"Change Status"}),B?e.jsx(g,{size:"sm"}):s.status!="approved"&&e.jsx(i,{color:"success",size:"sm",variant:"outline",onClick:()=>E(s._id),children:"Process"})]})]})})]},s._id)})})]})})]}),e.jsxs(K,{visible:F,onClose:()=>h(!1),children:[e.jsx(W,{children:e.jsx(Y,{children:"Change File Status"})}),e.jsx(X,{children:e.jsxs(J,{value:w,onChange:s=>S(s.target.value),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})}),e.jsx(G,{children:e.jsxs(e.Fragment,{children:[" ",e.jsx(i,{color:"secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx(i,{color:"primary",onClick:L,children:"Save"})]})})]})]})}export{ye as default};
