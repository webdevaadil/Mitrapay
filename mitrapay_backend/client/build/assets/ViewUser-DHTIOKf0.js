import{r as d,b as G,j as e,C as h,L as S,q as w,y as a}from"./index-S0OVyHNu.js";import{a as X,F as M,h as J,c as D}from"./index-BQvgzHxm.js";import{u as _,w as Q}from"./xlsx-DgYx1jvH.js";import{P as Y}from"./Pagination-B8ab6gOf.js";import{a as v}from"./index.esm-LEHn8Q-H.js";import{g as Z,h as ee,i as se,j as R}from"./DefaultLayout-D_FgM0Kl.js";import{M as b}from"./Modal-BTMROg-n.js";import{C as z}from"./CFormLabel-RGphUqCH.js";import{C as L}from"./CFormInput-DT5MO4RY.js";import"./CFocusTrap-DLS2BFbd.js";import"./cil-user-Dlmw-Gem.js";import"./index-CxJrV6_X.js";import"./setPrototypeOf-C3V6guyq.js";import"./CFormControlWrapper-D5pOIavM.js";import"./CFormControlValidation-DAm1qqxR.js";const s={background:"#121212",surface:"#1e1e1e",text:"#e0e0e0",textMuted:"#9e9e9e",border:"#333333",hover:"#2a2a2a",primary:"#90CAF9",success:"#A5D6A7",danger:"#EF9A9A",primaryBg:"#1a2b3c"};function fe(){const[p,y]=d.useState([]),[V,x]=d.useState(!1),B="rgb(255, 102, 178)",[g,I]=d.useState(""),[j,U]=d.useState(1),[O,K]=d.useState(1),F=10,{user:i,isAuthenticated:re}=G(r=>r.user),[oe,te]=d.useState(!1),[c,k]=d.useState(null),[f,N]=d.useState(0),[m,A]=d.useState(!1),E="#1e1e1e",H="#e0e0e0",W=async()=>{try{const t=(await w.get("/api/auth/Search_user?downloadAll=true",{withCredentials:!0})).data.users;if(!t||t.length===0){a.info("No users available to download");return}const l=t.map(n=>({Name:n.Name,Username:n.User_name,Email:n.email,Phone:n.Phone,TodayCredit:n.todayBalance,Credit:n.credit,AllTimeCredit:n.allTimeBalance,Status:n.status})),o=_.json_to_sheet(l),u=_.book_new();_.book_append_sheet(u,o,"Users"),Q(u,"users.xlsx")}catch(r){console.error("Error downloading Excel:",r),a.error("Failed to download Excel")}},T=async()=>{try{let r;const t=g.trim()!==""?`/api/auth/Search_user?searchKey=${g}&page=${j}&limit=${F}`:`/api/auth/View_user?page=${j}&limit=${F}`;r=await w.get(t,{withCredentials:!0}),y(r.data.users),K(r.data.pages)}catch(r){console.error("Error fetching users:",r),r.response&&r.response.status===401?a.error("Unauthorized access. Please log in again."):a.error("Failed to fetch user data.")}};d.useEffect(()=>{T()},[g,j]);const P=async(r,t)=>{try{y(l=>l.map(o=>o._id===r?{...o,loadingStatus:!0}:o)),await w.put(`/api/auth/updateUserStatus/${r}`,{status:t},{withCredentials:!0}),a.success("Status updated successfully"),y(l=>l.map(o=>o._id===r?{...o,status:t,loadingStatus:!1}:o))}catch(l){a.error("Failed to update status"),l.response&&l.response.status===401&&a.error("Unauthorized access. Please log in again."),y(o=>o.map(u=>u._id===r?{...u,loadingStatus:!1}:u))}},$=r=>{console.log(r),k(r),N(0),x(!0)},q=async()=>{var r,t,l;if(!c||f<=0){a.error("Please enter a valid amount of credit.");return}try{A(!0),await w.put("/api/auth/Add_Credit_User",{User_id:c._id,credit:Number(f)},{withCredentials:!0}),a.success("Credit Added successfully"),A(!1),x(!1),k(null),N(0),T()}catch(o){A(!1),console.log("Error adding credit:",((r=o.response)==null?void 0:r.data)||o.message),o.response&&o.response.status===401?a.error("Unauthorized access. Please log in again."):a.error(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to add credit.")}};if(!i)return e.jsxs("div",{className:"text-center py-5",style:{backgroundColor:s.background,color:s.text},children:[e.jsx(h,{color:"primary"})," Loading User Data..."]});let C=i.email==="tiger@gmail.com";return e.jsxs("div",{className:"min-vh-100",style:{backgroundColor:s.background},children:[e.jsx("div",{className:"border-bottom shadow-sm px-4 px-md-5 py-3",style:{backgroundColor:s.surface,borderColor:s.border},children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsx("h2",{className:"fw-bold mb-0",style:{color:s.text},children:"User Management"}),e.jsxs("div",{className:"d-flex align-items-center gap-3 w-100 w-md-auto justify-content-between justify-content-md-end",children:[e.jsx("img",{src:`https://placehold.co/48x48/0a0a0a/e0e0e0?text=${i.Name.charAt(0).toUpperCase()}`,alt:"user Avatar",className:"rounded-circle shadow-sm",width:"48",height:"48"}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-bold",style:{color:s.text},children:i.Name}),i.role!=="User"&&e.jsx("div",{className:"small badge",style:{backgroundColor:s.primaryBg,color:s.primary},children:i.role=="Sub_Admin"?"Co Admin":i.role})]})]})]})}),e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 px-4 px-md-5 pt-4 pb-3",children:[e.jsx("div",{className:"w-100 order-2 order-md-1",style:{maxWidth:"350px"},children:e.jsxs("div",{className:"input-group rounded-pill shadow-sm",style:{backgroundColor:s.surface},children:[e.jsx("span",{className:"input-group-text border-end-0 border-0 rounded-start-pill",style:{backgroundColor:s.surface},children:e.jsx(X,{style:{color:s.textMuted}})}),e.jsx("input",{type:"text",className:"form-control border-start-0 border-0 rounded-end-pill py-2",style:{backgroundColor:s.surface,color:s.text,"::placeholder":{color:s.textMuted}},placeholder:"Search User by name, email or username",value:g,onChange:r=>{I(r.target.value),U(1)}})]})}),e.jsxs("div",{className:"d-flex gap-3 order-1 order-md-2",children:[e.jsxs(S,{to:"/createUser",className:"btn btn-lg fw-bold px-4 rounded-pill shadow-sm d-flex align-items-center transition-all duration-300 hover:scale-105",style:{backgroundColor:"rgb(255, 102, 178)",color:"white",border:"none"},children:[e.jsx(M,{className:"me-2"}),"Create User"]}),e.jsx(v,{onClick:W,className:"rounded-pill shadow-sm d-flex align-items-center fw-bold transition-all duration-300 hover:scale-105",style:{backgroundColor:s.success,color:s.background,border:"none"},children:"Download Excel"})]})]}),e.jsx("div",{className:"px-4 px-md-5 d-none d-md-block pb-5",children:e.jsx("div",{className:"border rounded-4 shadow-lg overflow-hidden",style:{backgroundColor:s.surface,borderColor:s.border},children:e.jsxs("table",{className:"table table-hover align-middle mb-0",style:{"--bs-table-bg":s.surface,"--bs-table-hover-bg":s.hover},children:[e.jsx("thead",{style:{backgroundColor:s.primaryBg},className:"fw-semibold text-uppercase small",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4 py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Name"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Username"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Email"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Phone"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Today credit"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Credit"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"All time"}),e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Status"}),!C&&e.jsx("th",{className:"py-3",style:{color:s.textMuted,borderBottomColor:s.border},children:"Action"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:C?"8":"9",className:"text-center py-5 fst-italic",style:{color:s.textMuted,borderBottomColor:s.border},children:"No users found matching your search criteria."})}):p.map((r,t)=>e.jsxs("tr",{className:"transition-all duration-200",style:{borderBottom:`1px solid ${s.border}`},children:[e.jsx("td",{className:"ps-4 py-3 fw-bold",style:{color:s.text},children:r.Name}),e.jsx("td",{style:{color:s.textMuted},children:r.User_name}),e.jsx("td",{style:{color:s.text},children:r.email}),e.jsx("td",{style:{color:s.text},children:r.Phone}),e.jsxs("td",{className:"fw-semibold",style:{color:s.success},children:["₹",r.todayBalance]}),e.jsxs("td",{className:"fw-semibold",style:{color:s.primary},children:["₹",r.credit]}),e.jsxs("td",{className:"fw-semibold",style:{color:"#00B0FF"},children:["₹",r.allTimeBalance]})," ",e.jsx("td",{children:e.jsxs("button",{className:"px-3 py-1 rounded-pill border-0 d-inline-flex align-items-center fw-semibold transition-all duration-300 hover:shadow-md",onClick:()=>P(r._id,r.status==="Active"?"Inactive":"Active"),disabled:r.loadingStatus||m,style:{backgroundColor:r.status==="Active"?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",color:r.status==="Active"?s.success:s.danger,fontSize:"13px"},children:[r.loadingStatus?e.jsx(h,{size:"sm",color:r.status==="Active"?"danger":"success",className:"me-2"}):e.jsx("span",{style:{backgroundColor:r.status==="Active"?s.success:s.danger,width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px"}}),r.status]})}),!C&&e.jsx("td",{className:"position-relative",children:e.jsxs(Z,{alignment:"end",className:"d-inline-block",children:[e.jsx(ee,{caret:!1,className:"border-0 rounded-circle p-2",style:{fontSize:"16px",backgroundColor:s.hover,color:s.textMuted},children:e.jsx(J,{})}),e.jsxs(se,{className:"shadow-lg border-0 p-1 rounded-3",style:{minWidth:"160px",backgroundColor:s.surface,border:`1px solid ${s.border}`},children:[e.jsx(R,{className:"px-3 py-2",style:{color:s.text,backgroundColor:s.surface,"--bs-dropdown-link-hover-bg":s.hover},children:e.jsxs(S,{to:`/editUser/${r._id}`,className:"d-flex align-items-center text-decoration-none",style:{color:s.text},children:[e.jsx(D,{className:"me-2",style:{color:s.primary}}),"Edit User"]})}),e.jsx("hr",{className:"dropdown-divider my-1",style:{borderColor:s.border}}),e.jsx(R,{onClick:()=>$(r),className:"px-3 py-2",style:{color:s.text,backgroundColor:s.surface,"--bs-dropdown-link-hover-bg":s.hover},children:e.jsxs("a",{className:"d-flex align-items-center text-decoration-none",style:{color:s.text},children:[e.jsx(M,{className:"me-2",style:{color:s.success}}),"Add Credit"]})})]})]})})]},r._id))})]})})}),e.jsx("div",{className:"px-3 d-md-none pb-5 mt-4",children:p.length===0?e.jsx("div",{className:"text-center py-4 fst-italic",style:{color:s.textMuted},children:"No users found matching your search criteria."}):p.map((r,t)=>e.jsxs("div",{className:"border rounded-3 mb-3 p-3 shadow-sm transition-all duration-300 hover:shadow-md",style:{backgroundColor:s.surface,borderColor:s.border},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold fs-6 mb-1",style:{color:s.primary},children:r.Name}),e.jsxs("div",{className:"small",style:{color:s.textMuted},children:["@",r.User_name]})]}),e.jsx("div",{className:"pt-1",children:e.jsxs("button",{className:"px-3 py-1 rounded-pill border-0 d-inline-flex align-items-center fw-semibold",style:{backgroundColor:r.status==="Active"?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",color:r.status==="Active"?s.success:s.danger,fontSize:"13px"},onClick:()=>P(r._id,r.status==="Active"?"Inactive":"Active"),disabled:r.loadingStatus||m,children:[r.loadingStatus?e.jsx(h,{size:"sm",color:r.status==="Active"?"danger":"success",className:"me-2"}):e.jsx("span",{style:{backgroundColor:r.status==="Active"?s.success:s.danger,width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"6px"}}),r.status]})})]}),e.jsxs("div",{className:"small mb-1",style:{color:s.text},children:[e.jsx("strong",{children:"Email:"})," ",r.email]}),e.jsxs("div",{className:"small mb-1",style:{color:s.text},children:[e.jsx("strong",{children:"Phone:"})," ",r.Phone]}),e.jsxs("div",{className:"d-flex justify-content-between my-2 py-2",style:{borderTop:`1px solid ${s.border}`,borderBottom:`1px solid ${s.border}`},children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("strong",{className:"small",style:{color:s.textMuted},children:"Today Credit"}),e.jsxs("span",{className:"fw-semibold",style:{color:s.success},children:["₹",r.todayBalance]})]}),e.jsxs("div",{className:"d-flex flex-column text-center",children:[e.jsx("strong",{className:"small",style:{color:s.textMuted},children:"Current Credit"}),e.jsxs("span",{className:"fw-semibold",style:{color:s.primary},children:["₹",r.credit]})]}),e.jsxs("div",{className:"d-flex flex-column text-end",children:[e.jsx("strong",{className:"small",style:{color:s.textMuted},children:"All Time"}),e.jsxs("span",{className:"fw-semibold",style:{color:"#00B0FF"},children:["₹",r.allTimeBalance]})]})]}),!C&&e.jsxs("div",{className:"d-flex gap-2 pt-2",children:[e.jsxs("button",{onClick:()=>$(r),className:"btn btn-sm w-50 fw-semibold rounded-pill",style:{borderColor:s.success,color:s.success,backgroundColor:"transparent"},children:[e.jsx(M,{className:"me-1"})," Add Credit"]}),e.jsxs(S,{to:`/editUser/${r._id}`,className:"btn btn-sm w-50 fw-semibold rounded-pill",style:{borderColor:s.primary,color:s.primary,backgroundColor:"transparent"},children:[e.jsx(D,{className:"me-1"})," Edit User"]})]})]},r._id))}),e.jsxs(b,{show:V,onHide:()=>x(!1),centered:!0,contentClassName:"dark-modal-content","aria-labelledby":"AddCreditModalLabel",className:"rounded-lg",style:{"--cui-modal-bg":E,"--cui-modal-content-bg":E,"--cui-modal-color":H},children:[e.jsxs(b.Header,{style:{borderBottom:`2px solid ${B}33`},children:[e.jsxs(b.Title,{id:"AddCreditModalLabel",className:"fw-bold",style:{color:B},children:["Add Credit to ",c==null?void 0:c.Name]}),e.jsx(v,{className:"btn-close-white",onClick:()=>x(!1)})]}),e.jsx(b.Body,{children:m?e.jsxs("div",{className:"d-flex justify-content-center align-items-center py-5",children:[e.jsx(h,{color:"primary",style:{width:"3rem",height:"3rem",color:s.primary}}),e.jsx("span",{className:"ms-3 fw-semibold",style:{color:s.primary},children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(z,{htmlFor:"userName",className:"fw-semibold",style:{color:s.text},children:"User Name"}),e.jsx(L,{id:"userName",value:(c==null?void 0:c.Name)||"",disabled:!0,style:{backgroundColor:s.hover,color:s.textMuted,borderColor:s.border}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(z,{htmlFor:"creditAmount",className:"fw-semibold",style:{color:s.text},children:"Credit Amount (₹)"}),e.jsx(L,{id:"creditAmount",type:"number",value:f,onChange:r=>{N(Math.max(0,Number(r.target.value)))},placeholder:"Enter credit amount",min:"1",style:{backgroundColor:s.background,color:s.text,borderColor:s.border}})]})]})}),e.jsxs(b.Footer,{style:{borderTop:`1px solid ${s.border}`},children:[e.jsx(v,{onClick:()=>{x(!1),k(null),N(0)},disabled:m,style:{backgroundColor:s.hover,color:s.textMuted,border:`1px solid ${s.border}`},children:"Cancel"}),e.jsx(v,{onClick:q,disabled:m||f<=0||!c,className:"fw-bold",style:{backgroundColor:s.primary,color:s.background,border:"none"},children:m?e.jsx(h,{size:"sm",color:"white",className:"me-2"}):"Confirm Add"})]})]}),e.jsx(Y,{page:j,totalPages:O,setPage:U,darkStyles:{background:s.surface,text:s.text,primary:s.primary,hover:s.hover}})]})}export{fe as default};
